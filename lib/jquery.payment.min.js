(function(){var t,e,n,r,a,o,i,u,l,s,c,h,p,d,g,v,f,m,y,C,T,w,$,D=[].slice,S=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};t=window.jQuery||window.Zepto||window.$,t.payment={},t.payment.fn={},t.fn.payment=function(){var e,n;return n=arguments[0],e=2<=arguments.length?D.call(arguments,1):[],t.payment.fn[n].apply(this,e)},r=/(\d{1,4})/g,t.payment.cards=n=[{type:"maestro",patterns:[5018,502,503,506,56,58,639,6220,67],format:r,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"forbrugsforeningen",patterns:[600],format:r,length:[16],cvcLength:[3],luhn:!0},{type:"dankort",patterns:[5019],format:r,length:[16],cvcLength:[3],luhn:!0},{type:"visa",patterns:[4],format:r,length:[13,16],cvcLength:[3],luhn:!0},{type:"mastercard",patterns:[51,52,53,54,55,22,23,24,25,26,27],format:r,length:[16],cvcLength:[3],luhn:!0},{type:"amex",patterns:[34,37],format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"dinersclub",patterns:[30,36,38,39],format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:!0},{type:"discover",patterns:[60,64,65,622],format:r,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",patterns:[62,88],format:r,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"jcb",patterns:[35],format:r,length:[16],cvcLength:[3],luhn:!0}],t.payment.cardFromNumber=function(t){var e,r,a,o,i,u,l,s;for(t=(t+"").replace(/\D/g,""),o=0,u=n.length;u>o;o++)for(e=n[o],s=e.patterns,i=0,l=s.length;l>i;i++)if(a=s[i],r=a+"",t.substr(0,r.length)===r)return e},e=function(t){var e,r,a;for(r=0,a=n.length;a>r;r++)if(e=n[r],e.type===t)return e},h=function(t){var e,n,r,a,o,i;for(r=!0,a=0,n=(t+"").split("").reverse(),o=0,i=n.length;i>o;o++)e=n[o],e=parseInt(e,10),(r=!r)&&(e*=2),e>9&&(e-=9),a+=e;return a%10===0},c=function(t){var e;return null!=t.prop("selectionStart")&&t.prop("selectionStart")!==t.prop("selectionEnd")?!0:null!=("undefined"!=typeof document&&null!==document&&null!=(e=document.selection)?e.createRange:void 0)&&document.selection.createRange().text?!0:!1},w=function(t,e){var n,r,a,o,i,u;try{r=e.prop("selectionStart")}catch(l){o=l,r=null}return i=e.val(),e.val(t),null!==r&&e.is(":focus")?(r===i.length&&(r=t.length),i!==t&&(u=i.slice(r-1,+r+1||9e9),n=t.slice(r-1,+r+1||9e9),a=t[r],/\d/.test(a)&&u===""+a+" "&&n===" "+a&&(r+=1)),e.prop("selectionStart",r),e.prop("selectionEnd",r)):void 0},f=function(t){var e,n,r,a,o,i,u,l;for(null==t&&(t=""),r="０１２３４５６７８９",a="0123456789",i="",e=t.split(""),u=0,l=e.length;l>u;u++)n=e[u],o=r.indexOf(n),o>-1&&(n=a[o]),i+=n;return i},v=function(e){var n;return n=t(e.currentTarget),setTimeout(function(){var t;return t=n.val(),t=f(t),t=t.replace(/\D/g,""),w(t,n)})},d=function(e){var n;return n=t(e.currentTarget),setTimeout(function(){var e;return e=n.val(),e=f(e),e=t.payment.formatCardNumber(e),w(e,n)})},i=function(e){var n,r,a,o,i,u,l;return a=String.fromCharCode(e.which),!/^\d+$/.test(a)||(n=t(e.currentTarget),l=n.val(),r=t.payment.cardFromNumber(l+a),o=(l.replace(/\D/g,"")+a).length,u=16,r&&(u=r.length[r.length.length-1]),o>=u||null!=n.prop("selectionStart")&&n.prop("selectionStart")!==l.length)?void 0:(i=r&&"amex"===r.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,i.test(l)?(e.preventDefault(),setTimeout(function(){return n.val(l+" "+a)})):i.test(l+a)?(e.preventDefault(),setTimeout(function(){return n.val(l+a+" ")})):void 0)},a=function(e){var n,r;return n=t(e.currentTarget),r=n.val(),8!==e.which||null!=n.prop("selectionStart")&&n.prop("selectionStart")!==r.length?void 0:/\d\s$/.test(r)?(e.preventDefault(),setTimeout(function(){return n.val(r.replace(/\d\s$/,""))})):/\s\d?$/.test(r)?(e.preventDefault(),setTimeout(function(){return n.val(r.replace(/\d$/,""))})):void 0},g=function(e){var n;return n=t(e.currentTarget),setTimeout(function(){var e;return e=n.val(),e=f(e),e=t.payment.formatExpiry(e),w(e,n)})},u=function(e){var n,r,a;return r=String.fromCharCode(e.which),/^\d+$/.test(r)?(n=t(e.currentTarget),a=n.val()+r,/^\d$/.test(a)&&"0"!==a&&"1"!==a?(e.preventDefault(),setTimeout(function(){return n.val("0"+a+" / ")})):/^\d\d$/.test(a)?(e.preventDefault(),setTimeout(function(){var t,e;return t=parseInt(a[0],10),e=parseInt(a[1],10),e>2&&0!==t?n.val("0"+t+" / "+e):n.val(""+a+" / ")})):void 0):void 0},l=function(e){var n,r,a;return r=String.fromCharCode(e.which),/^\d+$/.test(r)?(n=t(e.currentTarget),a=n.val(),/^\d\d$/.test(a)?n.val(""+a+" / "):void 0):void 0},s=function(e){var n,r,a;return a=String.fromCharCode(e.which),"/"===a||" "===a?(n=t(e.currentTarget),r=n.val(),/^\d$/.test(r)&&"0"!==r?n.val("0"+r+" / "):void 0):void 0},o=function(e){var n,r;return n=t(e.currentTarget),r=n.val(),8!==e.which||null!=n.prop("selectionStart")&&n.prop("selectionStart")!==r.length?void 0:/\d\s\/\s$/.test(r)?(e.preventDefault(),setTimeout(function(){return n.val(r.replace(/\d\s\/\s$/,""))})):void 0},p=function(e){var n;return n=t(e.currentTarget),setTimeout(function(){var t;return t=n.val(),t=f(t),t=t.replace(/\D/g,"").slice(0,4),w(t,n)})},T=function(t){var e;return t.metaKey||t.ctrlKey?!0:32===t.which?!1:0===t.which?!0:t.which<33?!0:(e=String.fromCharCode(t.which),!!/[\d\s]/.test(e))},y=function(e){var n,r,a,o;return n=t(e.currentTarget),a=String.fromCharCode(e.which),/^\d+$/.test(a)&&!c(n)?(o=(n.val()+a).replace(/\D/g,""),r=t.payment.cardFromNumber(o),r?o.length<=r.length[r.length.length-1]:o.length<=16):void 0},C=function(e){var n,r,a;return n=t(e.currentTarget),r=String.fromCharCode(e.which),/^\d+$/.test(r)&&!c(n)?(a=n.val()+r,a=a.replace(/\D/g,""),a.length>6?!1:void 0):void 0},m=function(e){var n,r,a;return n=t(e.currentTarget),r=String.fromCharCode(e.which),/^\d+$/.test(r)&&!c(n)?(a=n.val()+r,a.length<=4):void 0},$=function(e){var r,a,o,i,u;return r=t(e.currentTarget),u=r.val(),i=t.payment.cardType(u)||"unknown",r.hasClass(i)?void 0:(a=function(){var t,e,r;for(r=[],t=0,e=n.length;e>t;t++)o=n[t],r.push(o.type);return r}(),r.removeClass("unknown"),r.removeClass(a.join(" ")),r.addClass(i),r.toggleClass("identified","unknown"!==i),r.trigger("payment.cardType",i))},t.payment.fn.formatCardCVC=function(){return this.on("keypress",T),this.on("keypress",m),this.on("paste",p),this.on("change",p),this.on("input",p),this},t.payment.fn.formatCardExpiry=function(){return this.on("keypress",T),this.on("keypress",C),this.on("keypress",u),this.on("keypress",s),this.on("keypress",l),this.on("keydown",o),this.on("change",g),this.on("input",g),this},t.payment.fn.formatCardNumber=function(){return this.on("keypress",T),this.on("keypress",y),this.on("keypress",i),this.on("keydown",a),this.on("keyup",$),this.on("paste",d),this.on("change",d),this.on("input",d),this.on("input",$),this},t.payment.fn.restrictNumeric=function(){return this.on("keypress",T),this.on("paste",v),this.on("change",v),this.on("input",v),this},t.payment.fn.cardExpiryVal=function(){return t.payment.cardExpiryVal(t(this).val())},t.payment.cardExpiryVal=function(t){var e,n,r,a;return a=t.split(/[\s\/]+/,2),e=a[0],r=a[1],2===(null!=r?r.length:void 0)&&/^\d+$/.test(r)&&(n=(new Date).getFullYear(),n=n.toString().slice(0,2),r=n+r),e=parseInt(e,10),r=parseInt(r,10),{month:e,year:r}},t.payment.validateCardNumber=function(e){var n,r;return e=(e+"").replace(/\s+|-/g,""),/^\d+$/.test(e)?(n=t.payment.cardFromNumber(e),n?(r=e.length,S.call(n.length,r)>=0&&(n.luhn===!1||h(e))):!1):!1},t.payment.validateCardExpiry=function(e,n){var r,a,o;return"object"==typeof e&&"month"in e&&(o=e,e=o.month,n=o.year),e&&n?(e=t.trim(e),n=t.trim(n),/^\d+$/.test(e)&&/^\d+$/.test(n)&&e>=1&&12>=e?(2===n.length&&(n=70>n?"20"+n:"19"+n),4!==n.length?!1:(a=new Date(n,e),r=new Date,a.setMonth(a.getMonth()-1),a.setMonth(a.getMonth()+1,1),a>r)):!1):!1},t.payment.validateCardCVC=function(n,r){var a,o;return n=t.trim(n),/^\d+$/.test(n)?(a=e(r),null!=a?(o=n.length,S.call(a.cvcLength,o)>=0):n.length>=3&&n.length<=4):!1},t.payment.cardType=function(e){var n;return e?(null!=(n=t.payment.cardFromNumber(e))?n.type:void 0)||null:null},t.payment.formatCardNumber=function(e){var n,r,a,o;return e=e.replace(/\D/g,""),(n=t.payment.cardFromNumber(e))?(a=n.length[n.length.length-1],e=e.slice(0,a),n.format.global?null!=(o=e.match(n.format))?o.join(" "):void 0:(r=n.format.exec(e),null!=r?(r.shift(),r=t.grep(r,function(t){return t}),r.join(" ")):void 0)):e},t.payment.formatExpiry=function(t){var e,n,r,a;return(n=t.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/))?(e=n[1]||"",r=n[2]||"",a=n[3]||"",a.length>0?r=" / ":" /"===r?(e=e.substring(0,1),r=""):2===e.length||r.length>0?r=" / ":1===e.length&&"0"!==e&&"1"!==e&&(e="0"+e,r=" / "),e+r+a):""}}).call(this);
